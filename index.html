<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Paw Paw | Enterprise System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f1f5f9; }
        .active-tab { background: #f97316 !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(249, 115, 22, 0.3); }
        .sidebar-item { transition: all 0.2s; border-radius: 12px; margin: 4px 12px; padding: 12px 16px; display: flex; align-items: center; gap: 12px; color: #94a3b8; width: 88%; text-align: left; }
        .sidebar-item:hover:not(.active-tab) { background: #134e4a; color: white; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside class="w-72 bg-teal-950 text-white flex flex-col shadow-2xl z-50">
        <div class="p-8 mb-4 flex items-center gap-3">
            <div class="w-10 h-10 bg-orange-500 rounded-xl flex items-center justify-center shadow-lg"><i class="fas fa-paw text-white text-xl"></i></div>
            <div><h1 class="text-xl font-extrabold tracking-tight">Le Paw Paw</h1><p class="text-[9px] tracking-[0.2em] text-teal-400 font-bold uppercase">Enterprise</p></div>
        </div>

        <nav class="flex-grow space-y-1">
            <button onclick="render('dash')" id="btn-dash" class="sidebar-item active-tab"><i class="fas fa-chart-line w-5"></i> Dashboard</button>
            <button onclick="render('clientes')" id="btn-clientes" class="sidebar-item"><i class="fas fa-id-card w-5"></i> Clientes & Pets</button>
            <button onclick="render('agenda')" id="btn-agenda" class="sidebar-item"><i class="fas fa-calendar-check w-5"></i> Reservas Pro</button>
            <button onclick="render('finanzas')" id="btn-finanzas" class="sidebar-item"><i class="fas fa-wallet w-5"></i> Finanzas</button>
            <button onclick="render('staff')" id="btn-staff" class="sidebar-item"><i class="fas fa-cut w-5"></i> Groomers</button>
            <button onclick="render('inventario')" id="btn-inventario" class="sidebar-item"><i class="fas fa-boxes w-5"></i> Inventario/Activos</button>
            <button onclick="render('admin')" id="btn-admin" class="sidebar-item"><i class="fas fa-user-shield w-5"></i> Administraci√≥n</button>
        </nav>

        <div class="p-6 border-t border-teal-900/50">
            <div class="bg-teal-900/40 p-4 rounded-2xl">
                <p class="text-[10px] text-teal-400 font-bold uppercase mb-1">Rol Actual</p>
                <select onchange="updateRole(this.value)" id="roleSelector" class="bg-transparent text-white text-xs font-bold outline-none w-full">
                    <option value="ADMIN" class="bg-teal-950">Administrador</option>
                    <option value="GROOMER" class="bg-teal-950">Groomer Staff</option>
                </select>
            </div>
        </div>
    </aside>

    <main class="flex-grow flex flex-col h-full overflow-hidden">
        <header class="h-20 bg-white border-b border-slate-200 px-10 flex justify-between items-center shrink-0">
            <h2 id="viewTitle" class="text-2xl font-black text-slate-800 uppercase tracking-tighter">Dashboard</h2>
            <div id="topAudit" class="text-[10px] font-mono text-slate-400 bg-slate-100 px-3 py-1 rounded">SYS_LOG: WAITING...</div>
        </header>

        <section id="viewport" class="p-10 overflow-y-auto flex-grow bg-slate-50"></section>
    </main>

    <script>
        // --- üß† CORE DATA & ENGINE ---
        let currentRole = 'ADMIN';
        const DB = {
            mascotas: JSON.parse(localStorage.getItem('lp_pets')) || [],
            citas: JSON.parse(localStorage.getItem('lp_citas')) || [],
            finanzas: JSON.parse(localStorage.getItem('lp_fin')) || [],
            staff: JSON.parse(localStorage.getItem('lp_staff')) || [{nombre: 'Groomer Principal', especialidad: 'Cortes', comision: 15, id: 1}],
            stock: JSON.parse(localStorage.getItem('lp_stock')) || [{nombre: 'Shampoo Pro', cant: 10, min: 2, id: 1}],
            activos: JSON.parse(localStorage.getItem('lp_activos')) || [{nombre: 'Secador Industrial', estado: 'Excelente', id: 1}],
            audit: []
        };

        function save() {
            localStorage.setItem('lp_pets', JSON.stringify(DB.mascotas));
            localStorage.setItem('lp_citas', JSON.stringify(DB.citas));
            localStorage.setItem('lp_fin', JSON.stringify(DB.finanzas));
            localStorage.setItem('lp_staff', JSON.stringify(DB.staff));
            localStorage.setItem('lp_stock', JSON.stringify(DB.stock));
            localStorage.setItem('lp_activos', JSON.stringify(DB.activos));
            log('DB_SYNC', 'SUCCESS');
        }

        function log(action, detail) {
            const entry = `${new Date().toLocaleTimeString()} | ${action} | ${detail}`;
            DB.audit.unshift(entry);
            document.getElementById('topAudit').innerText = `LOG: ${action} > ${detail}`;
        }

        function updateRole(val) {
            currentRole = val;
            log('ROLE_CHANGE', val);
            render(lastView);
        }

        let lastView = 'dash';

        // --- üé® RENDER ENGINE ---
        function render(view) {
            lastView = view;
            const v = document.getElementById('viewport');
            const t = document.getElementById('viewTitle');
            t.innerText = view;

            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active-tab'));
            document.getElementById(`btn-${view}`).classList.add('active-tab');

            if(view === 'dash') renderDash(v);
            if(view === 'clientes') renderClientes(v);
            if(view === 'agenda') renderAgenda(v);
            if(view === 'finanzas') renderFinanzas(v);
            if(view === 'staff') renderStaff(v);
            if(view === 'inventario') renderInventario(v);
            if(view === 'admin') renderAdmin(v);
        }

        // --- üìä DASHBOARD ---
        function renderDash(v) {
            const ingresos = DB.finanzas.filter(f => f.tipo === 'Ingreso').reduce((a,b) => a + Number(b.monto), 0);
            v.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-teal-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Total Pets</p>
                        <p class="text-4xl font-black text-slate-800">${DB.mascotas.length}</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-orange-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Citas Hoy</p>
                        <p class="text-4xl font-black text-slate-800">${DB.citas.length}</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-green-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Caja Total</p>
                        <p class="text-4xl font-black text-slate-800">$${ingresos}</p>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border-b-4 border-red-500">
                        <p class="text-xs font-bold text-slate-400 uppercase">Alertas Stock</p>
                        <p class="text-4xl font-black text-slate-800">${DB.stock.filter(s => s.cant <= s.min).length}</p>
                    </div>
                </div>
            `;
        }

        // --- üë• CLIENTES & PETS ---
        function renderClientes(v) {
            v.innerHTML = `
                <div class="bg-white p-8 rounded-3xl shadow-sm mb-8">
                    <h3 class="font-black text-slate-800 mb-6 uppercase tracking-tighter">Nueva Mascota</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input id="pName" placeholder="Nombre Mascota" class="p-4 bg-slate-50 rounded-xl outline-none ring-1 ring-slate-200">
                        <input id="pRaza" placeholder="Raza" class="p-4 bg-slate-50 rounded-xl outline-none ring-1 ring-slate-200">
                        <input id="pOwner" placeholder="Due√±o" class="p-4 bg-slate-50 rounded-xl outline-none ring-1 ring-slate-200">
                        <input id="pWA" placeholder="WA (ej: 57300...)" class="p-4 bg-slate-50 rounded-xl outline-none ring-1 ring-slate-200">
                        <textarea id="pNotas" placeholder="Alertas M√©dicas/Comportamiento" class="md:col-span-3 p-4 bg-slate-50 rounded-xl outline-none ring-1 ring-slate-200"></textarea>
                        <button onclick="addPet()" class="bg-teal-900 text-white font-black rounded-xl">REGISTRAR</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    ${DB.mascotas.map((m, i) => `
                        <div class="bg-white p-6 rounded-3xl shadow-sm border-l-8 border-orange-500">
                            <h4 class="text-xl font-black text-slate-800">${m.nombre}</h4>
                            <p class="text-xs font-bold text-teal-600 mb-2">${m.raza}</p>
                            <p class="text-xs mb-4">üë§ Propietario: <b>${m.duenio}</b></p>
                            <div class="bg-red-50 p-3 rounded-xl text-[11px] text-red-700 font-bold">‚ö†Ô∏è ${m.notas || 'Sin alertas'}</div>
                            ${currentRole === 'ADMIN' ? `<button onclick="delPet(${i})" class="mt-4 text-red-300 text-xs font-bold hover:text-red-600 uppercase">Eliminar Registro</button>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function addPet() {
            const pet = {
                nombre: document.getElementById('pName').value,
                raza: document.getElementById('pRaza').value,
                duenio: document.getElementById('pOwner').value,
                wa: document.getElementById('pWA').value,
                notas: document.getElementById('pNotas').value
            };
            if(!pet.nombre) return alert('Nombre Requerido');
            DB.mascotas.push(pet); save(); render('clientes');
        }

        function delPet(i) {
            if(confirm('Eliminar?')) { DB.mascotas.splice(i, 1); save(); render('clientes'); }
        }

        // --- üìÖ AGENDA PRO (SISTEMA DE CONSUMO) ---
        function renderAgenda(v) {
            v.innerHTML = `
                <div class="bg-white p-8 rounded-3
